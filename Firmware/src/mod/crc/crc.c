/***************************************************************************//**
 * @file        crc.c
 * @author      Created: CLU
 *              $Author: CLU $
 *              $LastChangedRevision: 440 $
 *              $LastChangedDate: 2010-05-20 09:59:35 +0200 (Do, 20 Mai 2010) $
 * @brief       functions for recursive 16bit crc computations
 ******************************************************************************/

/* Includes ------------------------------------------------------------------*/
#include "crc.h"

/* Private typedef -----------------------------------------------------------*/
/* Private define ------------------------------------------------------------*/
#define CRC16_START_VALUE        0x0001
#define CRC16_XOR_VALUE          0xFFFF

/* Private variables ---------------------------------------------------------*/
const u16 CRC16TAB[256] = {
/*   0 */     0, 32773, 32783,    10, 32795,    30,    20, 32785,
/*   8 */ 32819,    54,    60, 32825,    40, 32813, 32807,    34,
/*  16 */ 32867,   102,   108, 32873,   120, 32893, 32887,   114,
/*  24 */    80, 32853, 32863,    90, 32843,    78,    68, 32833,
/*  32 */ 32963,   198,   204, 32969,   216, 32989, 32983,   210,
/*  40 */   240, 33013, 33023,   250, 33003,   238,   228, 32993,
/*  48 */   160, 32933, 32943,   170, 32955,   190,   180, 32945,
/*  56 */ 32915,   150,   156, 32921,   136, 32909, 32903,   130,
/*  64 */ 33155,   390,   396, 33161,   408, 33181, 33175,   402,
/*  72 */   432, 33205, 33215,   442, 33195,   430,   420, 33185,
/*  80 */   480, 33253, 33263,   490, 33275,   510,   500, 33265,
/*  88 */ 33235,   470,   476, 33241,   456, 33229, 33223,   450,
/*  96 */   320, 33093, 33103,   330, 33115,   350,   340, 33105,
/* 104 */ 33139,   374,   380, 33145,   360, 33133, 33127,   354,
/* 112 */ 33059,   294,   300, 33065,   312, 33085, 33079,   306,
/* 120 */   272, 33045, 33055,   282, 33035,   270,   260, 33025,
/* 128 */ 33539,   774,   780, 33545,   792, 33565, 33559,   786,
/* 136 */   816, 33589, 33599,   826, 33579,   814,   804, 33569,
/* 144 */   864, 33637, 33647,   874, 33659,   894,   884, 33649,
/* 152 */ 33619,   854,   860, 33625,   840, 33613, 33607,   834,
/* 160 */   960, 33733, 33743,   970, 33755,   990,   980, 33745,
/* 168 */ 33779,  1014,  1020, 33785,  1000, 33773, 33767,   994,
/* 176 */ 33699,   934,   940, 33705,   952, 33725, 33719,   946,
/* 184 */   912, 33685, 33695,   922, 33675,   910,   900, 33665,
/* 192 */   640, 33413, 33423,   650, 33435,   670,   660, 33425,
/* 200 */ 33459,   694,   700, 33465,   680, 33453, 33447,   674,
/* 208 */ 33507,   742,   748, 33513,   760, 33533, 33527,   754,
/* 216 */   720, 33493, 33503,   730, 33483,   718,   708, 33473,
/* 224 */ 33347,   582,   588, 33353,   600, 33373, 33367,   594,
/* 232 */   624, 33397, 33407,   634, 33387,   622,   612, 33377,
/* 240 */   544, 33317, 33327,   554, 33339,   574,   564, 33329,
/* 248 */ 33299,   534,   540, 33305,   520, 33293, 33287,   514,
};

/*******************************************************************************
 * crc_init
 ******************************************************************************/
u16 crc_init(void) {
    return CRC16_START_VALUE;
}

/*******************************************************************************
 * crc_update
 ******************************************************************************/
u16 crc_update(u16 crcOld, u8 data) {
    return (crcOld << 8) ^ CRC16TAB[(crcOld >> 8) ^ data];
}

/*******************************************************************************
 * crc_finish
 ******************************************************************************/
u16 crc_finish(u8 crcOld) {
    return crcOld ^ CRC16_XOR_VALUE;
}

/*******************************************************************************
 * crc_calc
 ******************************************************************************/
u16 crc_calc(u8* pStart, u32 len) {
    u16 crc = crc_init();
    u8* p = pStart;
    for (u32 i=0; i<len; i++) crc = crc_update(crc, *(p++));
    return crc_finish(crc);
}

